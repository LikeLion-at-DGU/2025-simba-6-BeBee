{% block content %} 
{% load static %}
<link
    rel="stylesheet"
    type="text/css"
    href="{% static 'css/buddypage.css'%}"
/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&display=swap" rel="stylesheet">

<title>buddy page</title>

<body>
    <div class="honey-head">
        <img src="{% static 'assets/images/mainpage_img7.png' %}"
        alt="honey drip"
        class="honey-drip-img">
        <img src="{% static 'assets/images/mainpage_img7.png' %}"
        alt="honey drip"
        class="honey-drip-img">
    </div>
    <div class="buddypage-header">
        <img src="{% static 'assets/images/mainpage_buddypage_img.png' %}"
            alt="buddypage logo"
            class="buddypage-logo">
        <!--입력창 추가-->
        <form method="get" action="{% url 'accounts:buddypage' %}" class="search-box">
            <input type="text" name="q" placeholder="친구의 닉네임을 입력해주세요" value="{{ request.GET.q }}" />
            <button type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#888">
                    <path d="M0 0h24v24H0z" fill="none"/>
                    <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 
                        6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 
                        4.23-1.57l.27.28v.79l5 4.99L20.49 
                        19l-4.99-5zm-6 0C8.01 14 6 11.99 
                        6 9.5S8.01 5 10.5 5 15 7.01 15 
                        9.5 12.99 14 10.5 14z"/>
                </svg>
            </button>
        </form>
        <button type="button" class="calender-button" onclick="location.href='/'">Calender</button>
        <button type="button" class="buzzlist-button" onclick="location.href='/planner/subpage/'">BuzzList</button>
        <button type="button" class="mypage-button" onclick="location.href='<!--마이페이지 링크-->'">My Page</button>
        <img src="{% static 'assets/images/mainpage_honeypot_img.png' %}"
            alt="honeypot img"
            class="honeypot-img">
        <div class="amount-of-honey">
            <div class="amount-of-honey-text">현재 수집된 꿀</div>
            <div class="amount-of-honey-num">50g</div>
        </div>
    </div>

    <div class="buddy-list">
    {% for user in users %}
        <div class="buddy-item">
            <p>{{ user.username }} ({{ user.profile.univ }})</p>

            {% if user == request.user %}
                <p>
                    <span onclick="toggleList('followers-list')" style="cursor:pointer; text-decoration:underline;">
                        팔로워<br>{{ user.profile.followers.count }}명
                    </span>
                </p>
                <p>
                    <span onclick="toggleList('followings-list')" style="cursor:pointer; text-decoration:underline;">
                        팔로잉<br>{{ user.profile.followings.count }}명
                    </span>
                </p>

                <!-- 팔로워 목록 -->
                <div id="followers-list" style="display:none; margin-top:10px;">
                    {% for follower in user.profile.followers.all %}
                        <div class="buddy-subitem">
                            {{ follower.user.username }} ({{ follower.univ }})
                        </div>
                    {% empty %}
                        <div class="buddy-subitem">팔로워가 없습니다.</div>
                    {% endfor %}
                </div>

                <!-- 팔로잉 목록 -->
                <div id="followings-list" style="display:none; margin-top:10px;">
                    {% for following in user.profile.followings.all %}
                        <div class="buddy-subitem">
                            {{ following.user.username }} ({{ following.univ }})
                        </div>
                    {% empty %}
                        <div class="buddy-subitem">팔로잉한 사람이 없습니다.</div>
                    {% endfor %}
                </div>
            {% else %}
                <p>팔로워<br>{{ user.profile.followers.count }}명</p>
                <p>팔로잉<br>{{ user.profile.followings.count }}명</p>

                <form method="post" action="{% url 'accounts:follow' user.id %}">
                    {% csrf_token %}
                    {% if user.profile.id in following_ids %}
                        <button type="submit">언팔로우</button>
                    {% else %}
                        <button type="submit">팔로우</button>
                    {% endif %}
                </form>
            {% endif %}
        </div>
    {% endfor %}
    </div>

    <script>
        function toggleList(id) {
        const followerList = document.getElementById('followers-list');
        const followingList = document.getElementById('followings-list');

        
        if (id !== 'followers-list') followerList.style.display = 'none';
        if (id !== 'followings-list') followingList.style.display = 'none';

        
        const target = document.getElementById(id);
        target.style.display = (target.style.display === 'block') ? 'none' : 'block';
    }
    </script>
</body>

{% endblock %}
